compat: v0
id: synapse
version: 1.37.1~1
release-notes: "Upgrade to EmbassyOS v0.3.0"
license: apache
wrapper-repo: "https://github.com/Start9Labs/filebrowser-wrapper"
upstream-repo: "https://github.com/filebrowser/filebrowser"
build: ["make"]
min-os-version: "0.3.0"
title: Synapse
licenseName: Apache-2.0
licenseLink: https://github.com/matrix-org/synapse/blob/develop/LICENSE
description:
  short: Synapse is a battle-tested implementation of the Matrix protocol, the killer of all messaging apps.
  long: Synapse is the battle-tested, reference implementation of the Matrix protocol. Matrix is a next-generation, federated, full-featured, encrypted, independent messaging system. There are no trusted third parties involved. (see matrix.org for details).
assets:
  license: LICENSE
  icon: icon.png
  instructions: instructions.md
  docker-images: image.tar
  icon-type: png
main:
  type: docker
  image: main
  entrypoint: "/usr/local/bin/docker_entrypoint.sh"
  args: []
  mounts: {}
  io-format: yaml
health-checks: {}
config:
  get:
    type: docker
    image: compat
    system: true
    entrypoint: compat
    args: 
      - "config"
      - "get"
      - "/data/start9/config.yaml"
      - "/mnt/assets/config_spec.yaml"
    mounts:
      compat: "/mnt/assets"
      main: "/data"
    io-format: yaml
  set:
    type: docker
    image: compat
    system: true
    entrypoint: compat
    args:
      - "config"
      - "set"
      - "/data/start9/config.yaml"
    mounts:
      main: "/data"
    io-format: yaml
dependencies: {}
volumes: {}
interfaces:
  instructions:
    name: Instructions
    description: Displays instructions when visited in a browser
    tor-config:
      port-mapping:
        80: "80"
    ui: true
    protocols:
      - tcp
      - http
  matrix:
    name: Matrix Protocol
    description: Listens for Matrix clients and peers to federate with
    tor-config:
      port-mapping:
        443: "443"
        8448: "8448"
    ui: false
    protocols:
      - tcp
      - http
      - matrix
backup:
  create:
    type: docker
    image: duplicity
    system: true
    entrypoint: duplicity
    args:
      - /data
      - file:///mnt/backup
    mounts:
      BACKUP: "/mnt/backup"
      main: "/data"
  restore:
    type: docker
    image: duplicity
    system: true
    entrypoint: duplicity
    args:
      - file:///mnt/backup
      - /data
    mounts:
      BACKUP: "/mnt/backup"
      main: "/data" 
start-alert: "Important! After registering your first user, we highly recommend disabling user registrations. This can be done inside Config. If you do not disable registrations, anyone who knows your onion address can attack your embassy by spamming it with data through users they create."
actions:
  reset-first-user:
    name: Reset First User
    description: This action will reset the password of the first user in your database to a random value.
    allowed-statuses:
      - stopped
    implementation:
      type: docker
      image: compat
      system: true
      entrypoint: docker_entrypoint.sh
      args: ["reset-first-user"]
      mounts: {}
